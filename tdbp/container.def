Bootstrap: docker
From: ubuntu:24.04

%files
    TDBP_gpu2 /opt/TDBP_gpu2

%post
    export DEBIAN_FRONTEND=NONINTERACTIVE
    apt update -y
    apt install -y libfftw3-single3 libgdal34t64 libgomp1 liblapacke wget
    cd /opt
    wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2404/x86_64/cuda-ubuntu2404.pin
    mv cuda-ubuntu2404.pin /etc/apt/preferences.d/cuda-repository-pin-600
    wget https://developer.download.nvidia.com/compute/cuda/12.9.1/local_installers/cuda-repo-ubuntu2404-12-9-local_12.9.1-575.57.08-1_amd64.deb
    dpkg -i cuda-repo-ubuntu2404-12-9-local_12.9.1-575.57.08-1_amd64.deb
    cp /var/cuda-repo-ubuntu2404-12-9-local/cuda-*-keyring.gpg /usr/share/keyrings/
    apt-get update -y
    apt-get -y install cuda-toolkit-12-9

%environment
    export PATH="/opt/TDBP_gpu2/bin:/opt/TDBP_gpu2/scripts:$PATH"

%labels
  author Jenny Fothergill <jennyfothergill@boisestate.edu>
  github.com/bsurc/container git rev={{GIT_REV}}
